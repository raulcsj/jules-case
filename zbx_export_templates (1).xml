<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>6.0</version>
    <date>2025-10-20T13:52:34Z</date>
    <groups>
        <group>
            <uuid>a571c0d144b14fd4a87a9d9b2aa9fcd6</uuid>
            <name>Templates/Applications</name>
        </group>
    </groups>
    <templates>
        <template>
            <uuid>d0571c5f2c204b7ab244843040288a35</uuid>
            <template>Acronis Cyber Protect Cloud by HTTP</template>
            <name>Acronis Cyber Protect Cloud by HTTP</name>
            <description>Requests Acronis Cyber Protect Cloud API access token and creates host prototype for MSP.

Template uses HTTP item to query Acronis Cyber Protect Cloud API client for authorization.

Read the template documentation prior to using this template.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback

Generated by official Zabbix template tool &quot;Templator&quot;</description>
            <groups>
                <group>
                    <name>Templates/Applications</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>bce642c2c6e743ccb618c96f6ca533da</uuid>
                    <name>Acronis CPC: Get access token</name>
                    <type>HTTP_AGENT</type>
                    <key>acronis.cpc.account_manager.get_token</key>
                    <delay>{$ACRONIS.CPC.AUTH.INTERVAL}</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <authtype>BASIC</authtype>
                    <username>{$ACRONIS.CPC.AUTH.CLIENT.ID}</username>
                    <password>{$ACRONIS.CPC.AUTH.SECRET}</password>
                    <description>Authorizes API user and receives access token.</description>
                    <preprocessing>
                        <step>
                            <type>JAVASCRIPT</type>
                            <parameters>
                                <parameter>value = JSON.parse(value);

var list = [];
list.push({ 'scope': value['scope'].split(':')[3], 'access_token': value['access_token'] });
return JSON.stringify(list);</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>15s</timeout>
                    <url>{$ACRONIS.CPC.DATACENTER.URL}{$ACRONIS.CPC.PATH.ACCOUNT.MANAGEMENT}/idp/token</url>
                    <posts>grant_type=client_credentials</posts>
                    <status_codes/>
                    <http_proxy>{$ACRONIS.CPC.HTTP.PROXY}</http_proxy>
                    <headers>
                        <header>
                            <name>Content-Type</name>
                            <value>application/x-www-form-urlencoded</value>
                        </header>
                        <header>
                            <name>X-Application-Secret</name>
                            <value>5619386d-de56-49ec-8508-f5c399d3b9bd</value>
                        </header>
                    </headers>
                    <request_method>POST</request_method>
                    <tags>
                        <tag>
                            <tag>component</tag>
                            <value>authorization</value>
                        </tag>
                    </tags>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <uuid>d2c30d84c5f44734bc2f0ef38e99a959</uuid>
                    <name>Acronis CPC: MSP Discovery</name>
                    <type>DEPENDENT</type>
                    <key>acronis.cpc.lld.msp_discovery</key>
                    <delay>0</delay>
                    <description>Discovers MSP and creates host prototype based on that.</description>
                    <host_prototypes>
                        <host_prototype>
                            <uuid>bbdc747270f64876bc701dd87c27dbbe</uuid>
                            <host>Acronis CPC MSP {#SCOPE}</host>
                            <name>Acronis CPC MSP {#SCOPE}</name>
                            <group_links>
                                <group_link>
                                    <group>
                                        <name>Templates/Applications</name>
                                    </group>
                                </group_link>
                            </group_links>
                            <templates>
                                <template>
                                    <name>Acronis Cyber Protect Cloud MSP by HTTP</name>
                                </template>
                            </templates>
                            <macros>
                                <macro>
                                    <macro>{$ACRONIS.CPC.ACCESS_TOKEN}</macro>
                                    <value>{#ACCESS_TOKEN}</value>
                                    <description>Acronis CPC API access token.</description>
                                </macro>
                                <macro>
                                    <macro>{$ACRONIS.CPC.MSP.TENANT.UUID}</macro>
                                    <value>{#SCOPE}</value>
                                    <description>UUID of API client tenant.</description>
                                </macro>
                            </macros>
                        </host_prototype>
                    </host_prototypes>
                    <master_item>
                        <key>acronis.cpc.account_manager.get_token</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#ACCESS_TOKEN}</lld_macro>
                            <path>$.access_token</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#SCOPE}</lld_macro>
                            <path>$.scope</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                </discovery_rule>
            </discovery_rules>
            <tags>
                <tag>
                    <tag>class</tag>
                    <value>application</value>
                </tag>
                <tag>
                    <tag>target</tag>
                    <value>acronis</value>
                </tag>
                <tag>
                    <tag>target</tag>
                    <value>cyber-protect-cloud</value>
                </tag>
            </tags>
            <macros>
                <macro>
                    <macro>{$ACRONIS.CPC.AUTH.CLIENT.ID}</macro>
                    <description>Client ID for API user access.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.AUTH.INTERVAL}</macro>
                    <value>110m</value>
                    <description>API token regeneration interval, in minutes. By default, Acronis Cyber Protect Cloud tokens expire after 2 hours.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.AUTH.SECRET}</macro>
                    <type>SECRET_TEXT</type>
                    <description>Secret for API user access.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.DATACENTER.URL}</macro>
                    <description>Acronis Cyber Protect Cloud datacenter URL, e.g., https://eu2-cloud.acronis.com.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.HTTP.PROXY}</macro>
                    <description>Sets the HTTP proxy for the authorization item. Host prototypes will also use this value for HTTP proxy. If this parameter is empty, then no proxy is used.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.PATH.ACCOUNT.MANAGEMENT}</macro>
                    <value>/api/2</value>
                    <description>Sub-path for the Account Management API.</description>
                </macro>
            </macros>
        </template>
    </templates>
</zabbix_export>

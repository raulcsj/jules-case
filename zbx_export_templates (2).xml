<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>6.0</version>
    <date>2025-10-20T13:52:46Z</date>
    <groups>
        <group>
            <uuid>a571c0d144b14fd4a87a9d9b2aa9fcd6</uuid>
            <name>Templates/Applications</name>
        </group>
    </groups>
    <templates>
        <template>
            <uuid>bf3107deff3a4aabab1e1c0ee71a3281</uuid>
            <template>Acronis Cyber Protect Cloud MSP by HTTP</template>
            <name>Acronis Cyber Protect Cloud MSP by HTTP</name>
            <description>Discovers and monitors alerts, clients, devices using HTTP agent items.

This template receives API token and datacenter URL from parent host, therefore no additional configuration is necessary.

Read the template documentation prior to using this template.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback

Generated by official Zabbix template tool &quot;Templator&quot;</description>
            <groups>
                <group>
                    <name>Templates/Applications</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>dba9a02767be47819f7012f316723fff</uuid>
                    <name>Acronis CPC: Get alerts</name>
                    <type>HTTP_AGENT</type>
                    <key>acronis.cpc.alerts.get</key>
                    <delay>5m</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <description>Fetches all alerts.</description>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.items</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>15s</timeout>
                    <url>{$ACRONIS.CPC.DATACENTER.URL}{$ACRONIS.CPC.PATH.ALERTS}/alerts</url>
                    <status_codes/>
                    <http_proxy>{$ACRONIS.CPC.HTTP.PROXY}</http_proxy>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                        <header>
                            <name>Authorization</name>
                            <value>Bearer {$ACRONIS.CPC.ACCESS_TOKEN}</value>
                        </header>
                        <header>
                            <name>X-Application-Secret</name>
                            <value>5619386d-de56-49ec-8508-f5c399d3b9bd</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>component</tag>
                            <value>raw</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>483f9e040091476ba3857ae2957d83bf</uuid>
                    <name>Acronis CPC: Alerts with &quot;critical&quot; severity</name>
                    <type>DEPENDENT</type>
                    <key>acronis.cpc.alerts.severity.crit</key>
                    <delay>0</delay>
                    <history>7d</history>
                    <description>Gets count of alerts with &quot;critical&quot; severity.</description>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$..[?(@.severity == 'critical')].length()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1h</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>acronis.cpc.alerts.get</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>component</tag>
                            <value>alert</value>
                        </tag>
                        <tag>
                            <tag>component</tag>
                            <value>application</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>4fcefc1b66fe4c56b68cf5712aa727e5</uuid>
                    <name>Acronis CPC: Alerts with &quot;error&quot; severity</name>
                    <type>DEPENDENT</type>
                    <key>acronis.cpc.alerts.severity.err</key>
                    <delay>0</delay>
                    <history>7d</history>
                    <description>Gets count of alerts with &quot;error&quot; severity.</description>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$..[?(@.severity == 'error')].length()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1h</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>acronis.cpc.alerts.get</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>component</tag>
                            <value>alert</value>
                        </tag>
                        <tag>
                            <tag>component</tag>
                            <value>application</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>06003951452f4687bd0f1c0a395e7a77</uuid>
                    <name>Acronis CPC: Alerts with &quot;information&quot; severity</name>
                    <type>DEPENDENT</type>
                    <key>acronis.cpc.alerts.severity.info</key>
                    <delay>0</delay>
                    <history>7d</history>
                    <description>Gets count of alerts with &quot;information&quot; severity.</description>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$..[?(@.severity == 'information')].length()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1h</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>acronis.cpc.alerts.get</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>component</tag>
                            <value>alert</value>
                        </tag>
                        <tag>
                            <tag>component</tag>
                            <value>application</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>ca3a1c7649874dfdaf191c7063022498</uuid>
                    <name>Acronis CPC: Alerts with &quot;ok&quot; severity</name>
                    <type>DEPENDENT</type>
                    <key>acronis.cpc.alerts.severity.ok</key>
                    <delay>0</delay>
                    <history>7d</history>
                    <description>Gets count of alerts with &quot;ok&quot; severity.</description>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$..[?(@.severity == 'ok')].length()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1h</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>acronis.cpc.alerts.get</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>component</tag>
                            <value>alert</value>
                        </tag>
                        <tag>
                            <tag>component</tag>
                            <value>application</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>a4516d8961b3426f859511e1614c4403</uuid>
                    <name>Acronis CPC: Alerts with &quot;warning&quot; severity</name>
                    <type>DEPENDENT</type>
                    <key>acronis.cpc.alerts.severity.warn</key>
                    <delay>0</delay>
                    <history>7d</history>
                    <description>Gets count of alerts with &quot;warning&quot; severity.</description>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$..[?(@.severity == 'warning')].length()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1h</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>acronis.cpc.alerts.get</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>component</tag>
                            <value>alert</value>
                        </tag>
                        <tag>
                            <tag>component</tag>
                            <value>application</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>77f25dbbd477458a88f1850701dccc69</uuid>
                    <name>Acronis CPC: Get customers</name>
                    <type>HTTP_AGENT</type>
                    <key>acronis.cpc.customers.get</key>
                    <delay>5m</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <description>Fetches all customers.</description>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.items</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>15s</timeout>
                    <url>{$ACRONIS.CPC.DATACENTER.URL}{$ACRONIS.CPC.PATH.ACCOUNT.MANAGEMENT}/tenants</url>
                    <query_fields>
                        <query_field>
                            <name>subtree_root_id</name>
                            <value>{$ACRONIS.CPC.MSP.TENANT.UUID}</value>
                        </query_field>
                    </query_fields>
                    <status_codes/>
                    <http_proxy>{$ACRONIS.CPC.HTTP.PROXY}</http_proxy>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                        <header>
                            <name>Authorization</name>
                            <value>Bearer {$ACRONIS.CPC.ACCESS_TOKEN}</value>
                        </header>
                        <header>
                            <name>X-Application-Secret</name>
                            <value>5619386d-de56-49ec-8508-f5c399d3b9bd</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>component</tag>
                            <value>raw</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>81b3d23d30964b88aeb3a0911ba0e487</uuid>
                    <name>Acronis CPC: Get devices</name>
                    <type>HTTP_AGENT</type>
                    <key>acronis.cpc.devices.get</key>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <description>Fetches all devices.</description>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.items</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <timeout>15s</timeout>
                    <url>{$ACRONIS.CPC.DATACENTER.URL}{$ACRONIS.CPC.PATH.RESOURCE.MANAGEMENT}/resources</url>
                    <query_fields>
                        <query_field>
                            <name>type</name>
                            <value>{$ACRONIS.CPC.DEVICE.RESOURCE.TYPE}</value>
                        </query_field>
                    </query_fields>
                    <status_codes/>
                    <http_proxy>{$ACRONIS.CPC.HTTP.PROXY}</http_proxy>
                    <headers>
                        <header>
                            <name>Accept</name>
                            <value>application/json</value>
                        </header>
                        <header>
                            <name>Authorization</name>
                            <value>Bearer {$ACRONIS.CPC.ACCESS_TOKEN}</value>
                        </header>
                        <header>
                            <name>X-Application-Secret</name>
                            <value>5619386d-de56-49ec-8508-f5c399d3b9bd</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>component</tag>
                            <value>raw</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>3697d34ebbb74b90aa7318321ecc27e5</uuid>
                    <name>Acronis CPC: Register integration</name>
                    <type>SCRIPT</type>
                    <key>acronis.cpc.register.integration</key>
                    <delay>24h</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <params>
const request_path = '/api/integration_management/v2/status';
const app_id = '5619386d-de56-49ec-8508-f5c399d3b9bd';

function checkParams(params) {
	['api_url', 'api_token', 'tenant_uuid'].forEach(function (field) {
		if (typeof params !== 'object' || typeof params[field] === 'undefined' || params[field] === '') {
			throw 'Required param is not set: ' + field + '.';
		}
	});
	return params;
}

function getHttpData(url, register, params, api_token, tenant_uuid) {
	const request = new HttpRequest();

	request.addHeader('Content-Type: application/json');
	request.addHeader('Authorization: Bearer ' + api_token);
	request.addHeader('X-Application-Secret: ' + app_id);

	if (params['http_proxy']) {
		request.setProxy(params['http_proxy']);
		Zabbix.log(4, '[ ACRONIS CYBER PROTECT CLOUD API ] Using http proxy: ' + params['http_proxy']);
	}

	if (!register) {
		const response = request.get(url + '?tenantID=' + encodeURIComponent(tenant_uuid));
		Zabbix.log(4, '[ ACRONIS CYBER PROTECT CLOUD API ] [ ' + url + ' ] Received response with status code ' + request.getStatus() + ': ' + response);

		if (request.getStatus() !== 200) {
			if (typeof (response.error &amp;&amp; response.error.message) !== 'undefined') {
				throw response.error.message;
			} else {
				throw 'Failed to receive data: invalid response status code. Check debug log for more information.';
			}
		}

		return response;

	} else {

		const request_body = {
			&quot;application_id&quot;: app_id,
			&quot;module&quot;: {
				&quot;name&quot;: &quot;Zabbix integration with Acronis Cyber Protect Cloud&quot;,
				&quot;version&quot;: &quot;1.0.0&quot;
			},
			&quot;vendor_system&quot;: {
				&quot;name&quot;: &quot;Product integrated with Acronis&quot;,
				&quot;version&quot;: &quot;23.07&quot;
			},
			&quot;events&quot;: [
				{
					&quot;category&quot;: &quot;activation&quot;,
					&quot;action&quot;: &quot;activated integration&quot;,
					&quot;activation_event&quot;: true
				}
			]
		};

		const response = request.post(url + '?tenantID=' + encodeURIComponent(tenant_uuid), JSON.stringify(request_body));
		Zabbix.log(4, '[ ACRONIS CYBER PROTECT CLOUD API ] [ ' + url + ' ] Received response with status code ' + request.getStatus() + ': ' + response);

		if (request.getStatus() !== 204) {
			if (typeof (response.error &amp;&amp; response.error.message) !== 'undefined') {
				throw response.error.message;
			} else {
				throw 'Failed to receive data: invalid response status code. Check debug log for more information.';
			}
		}

		return 1;
	}
}

function parseGetStatusData(http_response) {
	const data = JSON.parse(http_response);
	if (data['items']) {
		data['items'].forEach(function (app) {
			if (app['application_id'] &amp;&amp; app['application_id'] === app_id) {
				return app['active'];
			}
		});
		return false;
	} else {
		throw 'Unexpected data structure in HTTP response.';
	}
}

const params = checkParams(JSON.parse(value)),
	url = params.api_url,
	api_token = params.api_token,
	tenant_uuid = params.tenant_uuid;

const current_activation_status = parseGetStatusData(getHttpData(url + request_path, false, params, api_token, tenant_uuid));

if (!current_activation_status) {
	return getHttpData(url + request_path, true, params, api_token, tenant_uuid);
} else {
	return 0;
}</params>
                    <description>Registers integration on Acronis services.</description>
                    <timeout>30s</timeout>
                    <parameters>
                        <parameter>
                            <name>api_token</name>
                            <value>{$ACRONIS.CPC.ACCESS_TOKEN}</value>
                        </parameter>
                        <parameter>
                            <name>api_url</name>
                            <value>{$ACRONIS.CPC.DATACENTER.URL}</value>
                        </parameter>
                        <parameter>
                            <name>tenant_uuid</name>
                            <value>{$ACRONIS.CPC.MSP.TENANT.UUID}</value>
                        </parameter>
                    </parameters>
                    <tags>
                        <tag>
                            <tag>component</tag>
                            <value>raw</value>
                        </tag>
                    </tags>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <uuid>ee0d74749b93459ca40e477b31b3aa21</uuid>
                    <name>Acronis CPC: Alerts discovery</name>
                    <type>DEPENDENT</type>
                    <key>acronis.cpc.alerts.discovery</key>
                    <delay>0</delay>
                    <filter>
                        <evaltype>AND</evaltype>
                        <conditions>
                            <condition>
                                <macro>{#CATEGORY}</macro>
                                <value>{$ACRONIS.CPC.ALERT.DISCOVERY.CATEGORY.MATCHES}</value>
                                <formulaid>A</formulaid>
                            </condition>
                            <condition>
                                <macro>{#CATEGORY}</macro>
                                <value>{$ACRONIS.CPC.ALERT.DISCOVERY.CATEGORY.NOT_MATCHES}</value>
                                <operator>NOT_MATCHES_REGEX</operator>
                                <formulaid>B</formulaid>
                            </condition>
                            <condition>
                                <macro>{#RESOURCE_NAME}</macro>
                                <value>{$ACRONIS.CPC.ALERT.DISCOVERY.RESOURCE.MATCHES}</value>
                                <formulaid>C</formulaid>
                            </condition>
                            <condition>
                                <macro>{#RESOURCE_NAME}</macro>
                                <value>{$ACRONIS.CPC.ALERT.DISCOVERY.RESOURCE.NOT_MATCHES}</value>
                                <operator>NOT_MATCHES_REGEX</operator>
                                <formulaid>D</formulaid>
                            </condition>
                            <condition>
                                <macro>{#SEVERITY}</macro>
                                <value>{$ACRONIS.CPC.ALERT.DISCOVERY.SEVERITY.MATCHES}</value>
                                <formulaid>E</formulaid>
                            </condition>
                            <condition>
                                <macro>{#SEVERITY}</macro>
                                <value>{$ACRONIS.CPC.ALERT.DISCOVERY.SEVERITY.NOT_MATCHES}</value>
                                <operator>NOT_MATCHES_REGEX</operator>
                                <formulaid>F</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <lifetime>0</lifetime>
                    <description>Discovers alerts.</description>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>b298e768dc0447b4b5c29c99a5852453</uuid>
                            <name>Alert [{#TYPE}]:[{#ALERT_ID}]: Alert severity</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.alert.severity[{#ALERT_ID}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <description>Severity for the alert.</description>
                            <valuemap>
                                <name>Alert severity</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$[?(@.id == &quot;{#ALERT_ID}&quot;)].severity.first()</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_ERROR</error_handler>
                                    <error_handler_params>Could not find alert severity</error_handler_params>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>const idx = [
	'ok',
	'warning',
	'error',
	'critical',
	'information'
].indexOf(value);
return idx !== -1 ? idx : 10;</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.alerts.get</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>category</tag>
                                    <value>{#CATEGORY}</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>alert</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#RESOURCE_NAME}</value>
                                </tag>
                                <tag>
                                    <tag>severity</tag>
                                    <value>{#SEVERITY}</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>f72a128c289540869ceeb4eb8a32519b</uuid>
                                    <expression>last(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.alert.severity[{#ALERT_ID}])=3</expression>
                                    <name>Alert [{#TYPE}]:[{#ALERT_ID}]: Alert has &quot;critical&quot; severity</name>
                                    <event_name>Alert [{#ALERT_ID}]: &quot;critical&quot; severity</event_name>
                                    <opdata>Alert type: {#TYPE}, Current status: {ITEM.LASTVALUE}</opdata>
                                    <priority>HIGH</priority>
                                    <description>Alert has &quot;critical&quot; severity.</description>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>scope</tag>
                                            <value>notice</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <uuid>360fcc25d3fe442194ddea76db8157be</uuid>
                                    <expression>last(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.alert.severity[{#ALERT_ID}])=2</expression>
                                    <name>Alert [{#TYPE}]:[{#ALERT_ID}]: Alert has &quot;error&quot; severity</name>
                                    <event_name>Alert [{#ALERT_ID}]: &quot;error&quot; severity</event_name>
                                    <opdata>Alert type: {#TYPE}, Current status: {ITEM.LASTVALUE}</opdata>
                                    <priority>AVERAGE</priority>
                                    <description>Alert has &quot;error&quot; severity.</description>
                                    <manual_close>YES</manual_close>
                                    <dependencies>
                                        <dependency>
                                            <name>Alert [{#TYPE}]:[{#ALERT_ID}]: Alert has &quot;critical&quot; severity</name>
                                            <expression>last(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.alert.severity[{#ALERT_ID}])=3</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>scope</tag>
                                            <value>notice</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <uuid>687b26d91e6e448d911663f190328fb4</uuid>
                                    <expression>last(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.alert.severity[{#ALERT_ID}])=1</expression>
                                    <name>Alert [{#TYPE}]:[{#ALERT_ID}]: Alert has &quot;warning&quot; severity</name>
                                    <event_name>Alert [{#ALERT_ID}]: &quot;warning&quot; severity</event_name>
                                    <opdata>Alert type: {#TYPE}, Current status: {ITEM.LASTVALUE}</opdata>
                                    <priority>WARNING</priority>
                                    <description>Alert has &quot;warning&quot; severity.</description>
                                    <manual_close>YES</manual_close>
                                    <dependencies>
                                        <dependency>
                                            <name>Alert [{#TYPE}]:[{#ALERT_ID}]: Alert has &quot;error&quot; severity</name>
                                            <expression>last(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.alert.severity[{#ALERT_ID}])=2</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>scope</tag>
                                            <value>notice</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>acronis.cpc.alerts.get</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#ALERT_ID}</lld_macro>
                            <path>$.id</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#CATEGORY}</lld_macro>
                            <path>$.category</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#RESOURCE_NAME}</lld_macro>
                            <path>$.details.resourceName</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#SEVERITY}</lld_macro>
                            <path>$.severity</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#TYPE}</lld_macro>
                            <path>$.type</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1h</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>4211387734c642f88e236bd588940cc1</uuid>
                    <name>Acronis CPC: Customer discovery</name>
                    <type>DEPENDENT</type>
                    <key>acronis.cpc.customer.discovery</key>
                    <delay>0</delay>
                    <filter>
                        <evaltype>AND</evaltype>
                        <conditions>
                            <condition>
                                <macro>{#KIND}</macro>
                                <value>{$ACRONIS.CPC.CUSTOMER.DISCOVERY.KIND.MATCHES}</value>
                                <formulaid>A</formulaid>
                            </condition>
                            <condition>
                                <macro>{#NAME}</macro>
                                <value>{$ACRONIS.CPC.CUSTOMER.DISCOVERY.NAME.MATCHES}</value>
                                <formulaid>B</formulaid>
                            </condition>
                            <condition>
                                <macro>{#NAME}</macro>
                                <value>{$ACRONIS.CPC.CUSTOMER.DISCOVERY.NAME.NOT_MATCHES}</value>
                                <operator>NOT_MATCHES_REGEX</operator>
                                <formulaid>C</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <lifetime>7d</lifetime>
                    <description>Discovers customers.</description>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>d61dc067880a4317886acd54d0df1da1</uuid>
                            <name>Customer [{#NAME}]: Enabled status</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.customer.status[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <description>Enabled status for customer (true or false).</description>
                            <valuemap>
                                <name>True false</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$[?(@.name == &quot;{#NAME}&quot;)].enabled.first()</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_ERROR</error_handler>
                                    <error_handler_params>Could not find customer status</error_handler_params>
                                </step>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <parameters>
                                        <parameter/>
                                    </parameters>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.customers.get</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>customer</value>
                                </tag>
                                <tag>
                                    <tag>customer</tag>
                                    <value>{#NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <master_item>
                        <key>acronis.cpc.customers.get</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#KIND}</lld_macro>
                            <path>$.kind</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#NAME}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1h</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
                <discovery_rule>
                    <uuid>67e399a0a6884589adc2618b181024e7</uuid>
                    <name>Acronis CPC: Device discovery</name>
                    <type>DEPENDENT</type>
                    <key>acronis.cpc.device.discovery</key>
                    <delay>0</delay>
                    <filter>
                        <evaltype>AND</evaltype>
                        <conditions>
                            <condition>
                                <macro>{#TENANT_NAME}</macro>
                                <value>{$ACRONIS.CPC.DEVICE.DISCOVERY.TENANT.MATCHES}</value>
                                <formulaid>A</formulaid>
                            </condition>
                            <condition>
                                <macro>{#TENANT_NAME}</macro>
                                <value>{$ACRONIS.CPC.DEVICE.DISCOVERY.TENANT.NOT_MATCHES}</value>
                                <operator>NOT_MATCHES_REGEX</operator>
                                <formulaid>B</formulaid>
                            </condition>
                        </conditions>
                    </filter>
                    <lifetime>7d</lifetime>
                    <description>Discovers devices.</description>
                    <item_prototypes>
                        <item_prototype>
                            <uuid>63f8280408c34e029085af75f15c0db3</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Agent enabled</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.agent.enabled[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <description>Agent status (enabled or disabled) for the device.</description>
                            <valuemap>
                                <name>True false</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.context.attributes.[?(@.name == &quot;agent&quot;)].kvs.[?(@.key == &quot;enabled&quot;)].value.first()</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_ERROR</error_handler>
                                    <error_handler_params>Could not parse agent status</error_handler_params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>7e33ba82ad90436c88beee8d32a3f29d</uuid>
                                    <expression>max(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.agent.enabled[{#NAME}],3m) &lt; 1</expression>
                                    <name>Device [{#NAME}]:[{#ID}]: Agent disabled</name>
                                    <opdata>Current score: {ITEM.LASTVALUE}</opdata>
                                    <priority>INFO</priority>
                                    <description>Agent for this device is disabled for at least 3 minutes.</description>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>scope</tag>
                                            <value>notice</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>e1eaefb0e0af4793abadb0b3ad20ff4b</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Agent online</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.agent.online[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <description>Agent reachability for the device.</description>
                            <valuemap>
                                <name>True false</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.context.attributes.[?(@.name == &quot;agent&quot;)].kvs.[?(@.key == &quot;is_online&quot;)].value.first()</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_ERROR</error_handler>
                                    <error_handler_params>Could not parse agent reachability status</error_handler_params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>7bc04c3526704b578e2b7561e6c97b6a</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Agent version</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.agent.version[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>0</trends>
                            <value_type>CHAR</value_type>
                            <description>Agent version for the device.</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.context.attributes.[?(@.name == &quot;agent&quot;)].kvs.[?(@.key == &quot;version&quot;)].value.first()</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_ERROR</error_handler>
                                    <error_handler_params>Could not parse agent version</error_handler_params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>d8c3372e05f3480aaa499b143ab47e87</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Next machine backup run</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.backup.next[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <units>unixtime</units>
                            <description>Next scheduled machine backup run for device.</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.policies.[?(@.type == &quot;policy.backup.machine&quot;)].next_run.first()</parameter>
                                    </parameters>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>return Math.floor(Date.parse(value) / 1000);</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>6a2c53a89d7748f89956464849d0b7de</uuid>
                                    <expression>last(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.backup.next[{#NAME}]) &lt; (now() + {$ACRONIS.CPC.OFFSET.SCHEDULED.BACKUP})</expression>
                                    <name>Device [{#NAME}]:[{#ID}]: Scheduled machine backup failed to run</name>
                                    <opdata>Scheduled: {ITEM.LASTVALUE1}</opdata>
                                    <priority>WARNING</priority>
                                    <description>Scheduled machine backup failed to run.</description>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>scope</tag>
                                            <value>notice</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>9fbbfa68438a406d82900d5c8801a756</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Previous successful machine backup run</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.backup.prev.ok[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <units>unixtime</units>
                            <description>Previous successful machine backup run for device.</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.policies.[?(@.type == &quot;policy.backup.machine&quot;)].last_success_run.first()</parameter>
                                    </parameters>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>return Math.floor(Date.parse(value) / 1000);</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>cea527353e34488a92dc5d2c082f6710</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Previous machine backup run</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.backup.prev[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <units>unixtime</units>
                            <description>Previous machine backup run for device.</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.policies.[?(@.type == &quot;policy.backup.machine&quot;)].last_run.first()</parameter>
                                    </parameters>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>return Math.floor(Date.parse(value) / 1000);</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>b45fb50f8caa40438eecfc4482d80fc2</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: CyberFit score</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.cyberfit[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <value_type>FLOAT</value_type>
                            <description>Acronis &quot;CyberFit&quot; score for the device. Value of &quot;-1&quot; is assigned if &quot;CyberFit&quot; could not be found for device.</description>
                            <valuemap>
                                <name>CyberFit score</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.context.attributes.[?(@.name == &quot;cyberfit&quot;)].details.[?(@.key == &quot;cyberfit_score_value&quot;)].value.first()</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_VALUE</error_handler>
                                    <error_handler_params>-1</error_handler_params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>0c7edd6256fc48c49316644faef8df0a</uuid>
                                    <expression>min(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.cyberfit[{#NAME}],3m) &lt; {$ACRONIS.CPC.CYBERFIT.HIGH}
and
max(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.cyberfit[{#NAME}],3m) &lt;&gt; -1</expression>
                                    <name>Device [{#NAME}]:[{#ID}]: CyberFit score critical</name>
                                    <opdata>Current score: {ITEM.LASTVALUE}</opdata>
                                    <priority>HIGH</priority>
                                    <description>CyberFit score for this device is critical for at least 3 minutes.</description>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>scope</tag>
                                            <value>notice</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <uuid>4c841b8207d642b28dbd365983aac0ec</uuid>
                                    <expression>min(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.cyberfit[{#NAME}],3m) &lt; {$ACRONIS.CPC.CYBERFIT.WARN}
and
max(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.cyberfit[{#NAME}],3m) &lt;&gt; -1</expression>
                                    <name>Device [{#NAME}]:[{#ID}]: CyberFit score low</name>
                                    <opdata>Current score: {ITEM.LASTVALUE}</opdata>
                                    <priority>WARNING</priority>
                                    <description>CyberFit score for this device is low for at least 3 minutes.</description>
                                    <manual_close>YES</manual_close>
                                    <dependencies>
                                        <dependency>
                                            <name>Device [{#NAME}]:[{#ID}]: CyberFit score critical</name>
                                            <expression>min(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.cyberfit[{#NAME}],3m) &lt; {$ACRONIS.CPC.CYBERFIT.HIGH}
and
max(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.cyberfit[{#NAME}],3m) &lt;&gt; -1</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>scope</tag>
                                            <value>notice</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>1f4d019c271c4272b055253d99d90244</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Next patch management run</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.patch.next[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <units>unixtime</units>
                            <description>Next scheduled patch management run for device.</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.policies.[?(@.type == &quot;policy.security.patch_management&quot;)].next_run.first()</parameter>
                                    </parameters>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>return Math.floor(Date.parse(value) / 1000);</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>7f82e95335b746c1a061b0ae811165a7</uuid>
                                    <expression>last(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.patch.next[{#NAME}]) &lt; (now() + {$ACRONIS.CPC.OFFSET.SCHEDULED.PATCH})</expression>
                                    <name>Device [{#NAME}]:[{#ID}]: Scheduled patch management failed to run</name>
                                    <opdata>Scheduled: {ITEM.LASTVALUE1}</opdata>
                                    <priority>WARNING</priority>
                                    <description>Scheduled patch management failed to run.</description>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>scope</tag>
                                            <value>notice</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>8ff39ea389ec4c53aa572074266536da</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Previous successful patch management run</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.patch.prev.ok[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <units>unixtime</units>
                            <description>Previous successful patch management run for device.</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.policies.[?(@.type == &quot;policy.security.patch_management&quot;)].last_success_run.first()</parameter>
                                    </parameters>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>return Math.floor(Date.parse(value) / 1000);</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>81bc4b10c3484673a76e9bb8e012af26</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Previous patch management run</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.patch.prev[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <units>unixtime</units>
                            <description>Previous patch management run for device.</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.policies.[?(@.type == &quot;policy.security.patch_management&quot;)].last_run.first()</parameter>
                                    </parameters>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>return Math.floor(Date.parse(value) / 1000);</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>43dc6e6bb7e042149b356fb6b067f0d5</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Protection plan name</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.protection.name[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>0</trends>
                            <value_type>CHAR</value_type>
                            <description>Protection plan name for device.</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.aggregate.names</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_ERROR</error_handler>
                                    <error_handler_params>Could not parse protection plan name</error_handler_params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>98701aa6f99f48c3a769529b2c3c3123</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Next antimalware protection scan</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.protection.scan.next[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <units>unixtime</units>
                            <description>Next scheduled antimalware protection scan for device.</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.policies.[?(@.type == &quot;policy.security.antimalware_protection&quot;)].next_run.first()</parameter>
                                    </parameters>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>return Math.floor(Date.parse(value) / 1000);</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>75156ffdb1ed4b90b594e50bce8752e5</uuid>
                                    <expression>last(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.protection.scan.next[{#NAME}]) &lt; (now() + {$ACRONIS.CPC.OFFSET.SCHEDULED.ANTIMALWARE})</expression>
                                    <name>Device [{#NAME}]:[{#ID}]: Scheduled antimalware scan failed to run</name>
                                    <opdata>Scheduled: {ITEM.LASTVALUE1}</opdata>
                                    <priority>WARNING</priority>
                                    <description>Scheduled antimalware scan failed to run.</description>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>scope</tag>
                                            <value>notice</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>d9510ad24a1a40dfb14313e0e135a247</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Previous successful antimalware protection scan</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.protection.scan.prev.ok[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <units>unixtime</units>
                            <description>Previous successful antimalware protection scan for device.</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.policies.[?(@.type == &quot;policy.security.antimalware_protection&quot;)].last_success_run.first()</parameter>
                                    </parameters>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>return Math.floor(Date.parse(value) / 1000);</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>684b4a46e4d84a588bd84fac3e6cfc55</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Previous antimalware protection scan</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.protection.scan.prev[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <units>unixtime</units>
                            <description>Previous antimalware protection scan for device.</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.policies.[?(@.type == &quot;policy.security.antimalware_protection&quot;)].last_run.first()</parameter>
                                    </parameters>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>return Math.floor(Date.parse(value) / 1000);</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>e0a94793d31c4cf08f64c0d230134870</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Protection status</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.protection.status[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <trends>0</trends>
                            <value_type>CHAR</value_type>
                            <description>Protection status for device.</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.aggregate.status</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_ERROR</error_handler>
                                    <error_handler_params>Could not parse protection status</error_handler_params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>0c38a47343cb4df4bda534982f344c15</uuid>
                                    <expression>last(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.protection.status[{#NAME}])=&quot;error&quot;</expression>
                                    <name>Device [{#NAME}]:[{#ID}]: Protection status &quot;error&quot;</name>
                                    <opdata>Current status: {ITEM.LASTVALUE}</opdata>
                                    <priority>AVERAGE</priority>
                                    <description>Device has &quot;error&quot; protection status.</description>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>scope</tag>
                                            <value>notice</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <uuid>3338e8c43c2149819e0a48156d6ec21a</uuid>
                                    <expression>last(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.protection.status[{#NAME}])=&quot;warning&quot;</expression>
                                    <name>Device [{#NAME}]:[{#ID}]: Protection status &quot;warning&quot;</name>
                                    <opdata>Current status: {ITEM.LASTVALUE}</opdata>
                                    <priority>WARNING</priority>
                                    <description>Device has &quot;warning&quot; protection status.</description>
                                    <manual_close>YES</manual_close>
                                    <dependencies>
                                        <dependency>
                                            <name>Device [{#NAME}]:[{#ID}]: Protection status &quot;error&quot;</name>
                                            <expression>last(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.protection.status[{#NAME}])=&quot;error&quot;</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>scope</tag>
                                            <value>notice</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>20d93972ca2f47af96aed7ee9aa642af</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Raw data resources status</name>
                            <type>HTTP_AGENT</type>
                            <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            <history>0</history>
                            <trends>0</trends>
                            <value_type>TEXT</value_type>
                            <description>Gets statuses for device resources.</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.items[0]</parameter>
                                    </parameters>
                                    <error_handler>CUSTOM_ERROR</error_handler>
                                    <error_handler_params>Could not parse resource status data</error_handler_params>
                                </step>
                            </preprocessing>
                            <timeout>15s</timeout>
                            <url>{$ACRONIS.CPC.DATACENTER.URL}{$ACRONIS.CPC.PATH.RESOURCE.MANAGEMENT}/resource_statuses</url>
                            <query_fields>
                                <query_field>
                                    <name>resource_id</name>
                                    <value>{#ID}</value>
                                </query_field>
                                <query_field>
                                    <name>include_attributes</name>
                                    <value>true</value>
                                </query_field>
                            </query_fields>
                            <status_codes/>
                            <http_proxy>{$ACRONIS.CPC.HTTP.PROXY}</http_proxy>
                            <headers>
                                <header>
                                    <name>Accept</name>
                                    <value>application/json</value>
                                </header>
                                <header>
                                    <name>Authorization</name>
                                    <value>Bearer {$ACRONIS.CPC.ACCESS_TOKEN}</value>
                                </header>
                                <header>
                                    <name>X-Application-Secret</name>
                                    <value>5619386d-de56-49ec-8508-f5c399d3b9bd</value>
                                </header>
                            </headers>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>raw</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>e6905aa1998a41cfa0e6fda699558ceb</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Next vulnerability assessment</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.vuln.next[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <units>unixtime</units>
                            <description>Next scheduled vulnerability assessment for device.</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.policies.[?(@.type == &quot;policy.security.vulnerability_assessment&quot;)].next_run.first()</parameter>
                                    </parameters>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>return Math.floor(Date.parse(value) / 1000);</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <uuid>b71001b751594fc5b4b9b38673133171</uuid>
                                    <expression>last(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.vuln.next[{#NAME}]) &lt; (now() + {$ACRONIS.CPC.OFFSET.SCHEDULED.VULNERABILITY})</expression>
                                    <name>Device [{#NAME}]:[{#ID}]: Scheduled vulnerability assessment failed to run</name>
                                    <opdata>Scheduled: {ITEM.LASTVALUE1}</opdata>
                                    <priority>WARNING</priority>
                                    <description>Scheduled vulnerability assessment failed to run.</description>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>scope</tag>
                                            <value>notice</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <uuid>36fb3f57c4ae4f5cad01913a453869dc</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Previous successful vulnerability assessment</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.vuln.prev.ok[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <units>unixtime</units>
                            <description>Previous successful vulnerability assessment for device.</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.policies.[?(@.type == &quot;policy.security.vulnerability_assessment&quot;)].last_success_run.first()</parameter>
                                    </parameters>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>return Math.floor(Date.parse(value) / 1000);</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                        <item_prototype>
                            <uuid>9a45c38169c848fd92b8e6a782ad065b</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: Previous vulnerability assessment</name>
                            <type>DEPENDENT</type>
                            <key>acronis.cpc.device.vuln.prev[{#NAME}]</key>
                            <delay>0</delay>
                            <history>7d</history>
                            <units>unixtime</units>
                            <description>Previous vulnerability assessment for device.</description>
                            <preprocessing>
                                <step>
                                    <type>JSONPATH</type>
                                    <parameters>
                                        <parameter>$.policies.[?(@.type == &quot;policy.security.vulnerability_assessment&quot;)].last_run.first()</parameter>
                                    </parameters>
                                    <error_handler>DISCARD_VALUE</error_handler>
                                </step>
                                <step>
                                    <type>JAVASCRIPT</type>
                                    <parameters>
                                        <parameter>return Math.floor(Date.parse(value) / 1000);</parameter>
                                    </parameters>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <parameters>
                                        <parameter>1h</parameter>
                                    </parameters>
                                </step>
                            </preprocessing>
                            <master_item>
                                <key>acronis.cpc.device.res.status.raw[{#NAME}]</key>
                            </master_item>
                            <tags>
                                <tag>
                                    <tag>component</tag>
                                    <value>application</value>
                                </tag>
                                <tag>
                                    <tag>component</tag>
                                    <value>device</value>
                                </tag>
                                <tag>
                                    <tag>resource</tag>
                                    <value>{#NAME}</value>
                                </tag>
                                <tag>
                                    <tag>tenant</tag>
                                    <value>{#TENANT_NAME}</value>
                                </tag>
                            </tags>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <uuid>f0a9c94a81ef4018a76b73cb98780f1f</uuid>
                            <expression>max(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.backup.prev.ok[{#NAME}],1m)&lt;&gt;max(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.backup.prev[{#NAME}],1m)</expression>
                            <name>Device [{#NAME}]:[{#ID}]: Previous machine backup run not successful</name>
                            <opdata>Last scan: {ITEM.LASTVALUE2}, Last OK scan: {ITEM.LASTVALUE1}</opdata>
                            <priority>AVERAGE</priority>
                            <description>Previous machine backup did not run successfully.</description>
                            <manual_close>YES</manual_close>
                            <tags>
                                <tag>
                                    <tag>scope</tag>
                                    <value>notice</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>5ce3f0bc18cd40878059b48ba436fa6d</uuid>
                            <expression>max(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.patch.prev.ok[{#NAME}],1m)&lt;&gt;max(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.patch.prev[{#NAME}],1m)</expression>
                            <name>Device [{#NAME}]:[{#ID}]: Previous patch management run not successful</name>
                            <opdata>Last scan: {ITEM.LASTVALUE2}, Last OK scan: {ITEM.LASTVALUE1}</opdata>
                            <priority>AVERAGE</priority>
                            <description>Previous patch management run did not run successfully.</description>
                            <manual_close>YES</manual_close>
                            <tags>
                                <tag>
                                    <tag>scope</tag>
                                    <value>notice</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>b0341da543c34c9491863a6fb8caea0c</uuid>
                            <expression>last(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.protection.scan.prev.ok[{#NAME}])&lt;&gt;last(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.protection.scan.prev[{#NAME}])</expression>
                            <name>Device [{#NAME}]:[{#ID}]: Previous protection scan not successful</name>
                            <opdata>Last scan: {ITEM.LASTVALUE2}, Last OK scan: {ITEM.LASTVALUE1}</opdata>
                            <priority>AVERAGE</priority>
                            <description>Device has &quot;error&quot; protection status.</description>
                            <manual_close>YES</manual_close>
                            <tags>
                                <tag>
                                    <tag>scope</tag>
                                    <value>notice</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <uuid>3c0f47531c1a435eb93d01107a6e0b3d</uuid>
                            <expression>max(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.vuln.prev.ok[{#NAME}],1m)&lt;&gt;max(/Acronis Cyber Protect Cloud MSP by HTTP/acronis.cpc.device.vuln.prev[{#NAME}],1m)</expression>
                            <name>Device [{#NAME}]:[{#ID}]: Previous vulnerability assessment not successful</name>
                            <opdata>Last scan: {ITEM.LASTVALUE2}, Last OK scan: {ITEM.LASTVALUE1}</opdata>
                            <priority>AVERAGE</priority>
                            <description>Previous vulnerability assessment did not run successfully.</description>
                            <manual_close>YES</manual_close>
                            <tags>
                                <tag>
                                    <tag>scope</tag>
                                    <value>notice</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <uuid>feba1571ed4a47d5a5bbbb16153983b0</uuid>
                            <name>Device [{#NAME}]:[{#ID}]: CyberFit score</name>
                            <graph_items>
                                <graph_item>
                                    <color>199C0D</color>
                                    <item>
                                        <host>Acronis Cyber Protect Cloud MSP by HTTP</host>
                                        <key>acronis.cpc.device.cyberfit[{#NAME}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                    <master_item>
                        <key>acronis.cpc.devices.get</key>
                    </master_item>
                    <lld_macro_paths>
                        <lld_macro_path>
                            <lld_macro>{#ID}</lld_macro>
                            <path>$.id</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#NAME}</lld_macro>
                            <path>$.name</path>
                        </lld_macro_path>
                        <lld_macro_path>
                            <lld_macro>{#TENANT_NAME}</lld_macro>
                            <path>$.tenant_name</path>
                        </lld_macro_path>
                    </lld_macro_paths>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1h</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                </discovery_rule>
            </discovery_rules>
            <tags>
                <tag>
                    <tag>class</tag>
                    <value>application</value>
                </tag>
                <tag>
                    <tag>target</tag>
                    <value>acronis</value>
                </tag>
                <tag>
                    <tag>target</tag>
                    <value>cyber-protect-cloud</value>
                </tag>
            </tags>
            <macros>
                <macro>
                    <macro>{$ACRONIS.CPC.ACCESS_TOKEN}</macro>
                    <type>SECRET_TEXT</type>
                    <description>API access token.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.ALERT.DISCOVERY.CATEGORY.MATCHES}</macro>
                    <value>.*</value>
                    <description>Sets the alert category regex filter to use in alert discovery for including.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.ALERT.DISCOVERY.CATEGORY.NOT_MATCHES}</macro>
                    <value>CHANGE_IF_NEEDED</value>
                    <description>Sets the alert category regex filter to use in alert discovery for excluding.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.ALERT.DISCOVERY.RESOURCE.MATCHES}</macro>
                    <value>.*</value>
                    <description>Sets the alert resource name regex filter to use in alert discovery for including.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.ALERT.DISCOVERY.RESOURCE.NOT_MATCHES}</macro>
                    <value>CHANGE_IF_NEEDED</value>
                    <description>Sets the alert resource name regex filter to use in alert discovery for excluding.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.ALERT.DISCOVERY.SEVERITY.MATCHES}</macro>
                    <value>.*</value>
                    <description>Sets the alert severity regex filter to use in alert discovery for including.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.ALERT.DISCOVERY.SEVERITY.NOT_MATCHES}</macro>
                    <value>CHANGE_IF_NEEDED</value>
                    <description>Sets the alert severity regex filter to use in alert discovery for excluding.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.CUSTOMER.DISCOVERY.KIND.MATCHES}</macro>
                    <value>customer</value>
                    <description>Sets the customer name regex filter to use in customer discovery for including.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.CUSTOMER.DISCOVERY.NAME.MATCHES}</macro>
                    <value>.*</value>
                    <description>Sets the customer name regex filter to use in customer discovery for including.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.CUSTOMER.DISCOVERY.NAME.NOT_MATCHES}</macro>
                    <value>CHANGE_IF_NEEDED</value>
                    <description>Sets the customer name regex filter to use in customer discovery for excluding.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.CYBERFIT.HIGH}</macro>
                    <value>579</value>
                    <description>CyberFit score threshold for &quot;high&quot; severity trigger.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.CYBERFIT.WARN}</macro>
                    <value>669</value>
                    <description>CyberFit score threshold for &quot;warning&quot; severity trigger.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.DATACENTER.URL}</macro>
                    <description>Acronis Cyber Protect Cloud datacenter URL, e.g., https://eu2-cloud.acronis.com.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.DEVICE.DISCOVERY.TENANT.MATCHES}</macro>
                    <value>.*</value>
                    <description>Sets the tenant name regex filter to use in device discovery for including.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.DEVICE.DISCOVERY.TENANT.NOT_MATCHES}</macro>
                    <value>CHANGE_IF_NEEDED</value>
                    <description>Sets the tenant name regex filter to use in device discovery for excluding.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.DEVICE.RESOURCE.TYPE}</macro>
                    <value>resource.machine</value>
                    <description>Comma separated list of resource types for devices retrieval.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.HTTP.PROXY}</macro>
                    <description>Sets the HTTP proxy for the authorization item. Host prototypes will also use this value for HTTP proxy. If this parameter is empty, then no proxy is used.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.MSP.TENANT.UUID}</macro>
                    <description>UUID for MSP.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.OFFSET.SCHEDULED.ANTIMALWARE}</macro>
                    <value>-180</value>
                    <description>Offset time in seconds for scheduled antimalware scan trigger check.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.OFFSET.SCHEDULED.BACKUP}</macro>
                    <value>-180</value>
                    <description>Offset time in seconds for scheduled backup run trigger check.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.OFFSET.SCHEDULED.PATCH}</macro>
                    <value>-180</value>
                    <description>Offset time in seconds for scheduled patch management run trigger check.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.OFFSET.SCHEDULED.VULNERABILITY}</macro>
                    <value>-180</value>
                    <description>Offset time in seconds for scheduled vulnerability assessment run trigger check.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.PATH.ACCOUNT.MANAGEMENT}</macro>
                    <value>/api/2</value>
                    <description>Sub-path for the Account Management API.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.PATH.AGENTS}</macro>
                    <value>/api/agent_manager/v2</value>
                    <description>Sub-path for the Agents API.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.PATH.ALERTS}</macro>
                    <value>/api/alert_manager/v1</value>
                    <description>Sub-path for the Alerts API.</description>
                </macro>
                <macro>
                    <macro>{$ACRONIS.CPC.PATH.RESOURCE.MANAGEMENT}</macro>
                    <value>/api/resource_management/v4</value>
                    <description>Sub-path for the Resource Management API.</description>
                </macro>
            </macros>
            <dashboards>
                <dashboard>
                    <uuid>711853342bbe4a5b8d145fc96644d1e5</uuid>
                    <name>Acronis Cyber Protect Cloud Overview</name>
                    <pages>
                        <page>
                            <widgets>
                                <widget>
                                    <type>ITEM</type>
                                    <width>3</width>
                                    <height>3</height>
                                    <hide_header>YES</hide_header>
                                    <fields>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>adv_conf</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>STRING</type>
                                            <name>bg_color</name>
                                            <value>1EA7FD</value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>decimal_places</name>
                                            <value>0</value>
                                        </field>
                                        <field>
                                            <type>STRING</type>
                                            <name>description</name>
                                            <value>&quot;Information&quot; severity alert count</value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>desc_size</name>
                                            <value>8</value>
                                        </field>
                                        <field>
                                            <type>ITEM</type>
                                            <name>itemid</name>
                                            <value>
                                                <host>Acronis Cyber Protect Cloud MSP by HTTP</host>
                                                <key>acronis.cpc.alerts.severity.info</key>
                                            </value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>show</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>show</name>
                                            <value>2</value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>ITEM</type>
                                    <y>3</y>
                                    <width>3</width>
                                    <height>3</height>
                                    <hide_header>YES</hide_header>
                                    <fields>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>adv_conf</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>STRING</type>
                                            <name>bg_color</name>
                                            <value>66BF3C</value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>decimal_places</name>
                                            <value>0</value>
                                        </field>
                                        <field>
                                            <type>STRING</type>
                                            <name>description</name>
                                            <value>&quot;OK&quot; severity alert count</value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>desc_size</name>
                                            <value>8</value>
                                        </field>
                                        <field>
                                            <type>ITEM</type>
                                            <name>itemid</name>
                                            <value>
                                                <host>Acronis Cyber Protect Cloud MSP by HTTP</host>
                                                <key>acronis.cpc.alerts.severity.ok</key>
                                            </value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>show</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>show</name>
                                            <value>2</value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>ITEM</type>
                                    <y>6</y>
                                    <width>3</width>
                                    <height>3</height>
                                    <hide_header>YES</hide_header>
                                    <fields>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>adv_conf</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>STRING</type>
                                            <name>bg_color</name>
                                            <value>E69D00</value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>decimal_places</name>
                                            <value>0</value>
                                        </field>
                                        <field>
                                            <type>STRING</type>
                                            <name>description</name>
                                            <value>&quot;Warning&quot; severity alert count</value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>desc_size</name>
                                            <value>8</value>
                                        </field>
                                        <field>
                                            <type>ITEM</type>
                                            <name>itemid</name>
                                            <value>
                                                <host>Acronis Cyber Protect Cloud MSP by HTTP</host>
                                                <key>acronis.cpc.alerts.severity.warn</key>
                                            </value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>show</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>show</name>
                                            <value>2</value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>ITEM</type>
                                    <y>9</y>
                                    <width>3</width>
                                    <height>3</height>
                                    <hide_header>YES</hide_header>
                                    <fields>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>adv_conf</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>STRING</type>
                                            <name>bg_color</name>
                                            <value>FF4400</value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>decimal_places</name>
                                            <value>0</value>
                                        </field>
                                        <field>
                                            <type>STRING</type>
                                            <name>description</name>
                                            <value>&quot;Error&quot; severity alert count</value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>desc_size</name>
                                            <value>8</value>
                                        </field>
                                        <field>
                                            <type>ITEM</type>
                                            <name>itemid</name>
                                            <value>
                                                <host>Acronis Cyber Protect Cloud MSP by HTTP</host>
                                                <key>acronis.cpc.alerts.severity.err</key>
                                            </value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>show</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>show</name>
                                            <value>2</value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>ITEM</type>
                                    <y>12</y>
                                    <width>3</width>
                                    <height>3</height>
                                    <hide_header>YES</hide_header>
                                    <fields>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>adv_conf</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>STRING</type>
                                            <name>bg_color</name>
                                            <value>E23636</value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>decimal_places</name>
                                            <value>0</value>
                                        </field>
                                        <field>
                                            <type>STRING</type>
                                            <name>description</name>
                                            <value>&quot;Critical&quot; severity alert count</value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>desc_size</name>
                                            <value>8</value>
                                        </field>
                                        <field>
                                            <type>ITEM</type>
                                            <name>itemid</name>
                                            <value>
                                                <host>Acronis Cyber Protect Cloud MSP by HTTP</host>
                                                <key>acronis.cpc.alerts.severity.crit</key>
                                            </value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>show</name>
                                            <value>1</value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>show</name>
                                            <value>2</value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>GRAPH_CLASSIC</type>
                                    <x>3</x>
                                    <width>4</width>
                                    <height>6</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Acronis Cyber Protect Cloud MSP by HTTP</host>
                                                <name>Acronis CPC: Alerts overview</name>
                                            </value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>GRAPH_PROTOTYPE</type>
                                    <x>3</x>
                                    <y>6</y>
                                    <width>12</width>
                                    <height>9</height>
                                    <fields>
                                        <field>
                                            <type>GRAPH_PROTOTYPE</type>
                                            <name>graphid</name>
                                            <value>
                                                <host>Acronis Cyber Protect Cloud MSP by HTTP</host>
                                                <name>Device [{#NAME}]:[{#ID}]: CyberFit score</name>
                                            </value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>rows</name>
                                            <value>2</value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>GRAPH_PROTOTYPE</type>
                                    <x>7</x>
                                    <width>8</width>
                                    <height>6</height>
                                    <fields>
                                        <field>
                                            <type>ITEM_PROTOTYPE</type>
                                            <name>itemid</name>
                                            <value>
                                                <host>Acronis Cyber Protect Cloud MSP by HTTP</host>
                                                <key>acronis.cpc.customer.status[{#NAME}]</key>
                                            </value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>source_type</name>
                                            <value>3</value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>GRAPH_PROTOTYPE</type>
                                    <x>15</x>
                                    <width>9</width>
                                    <height>7</height>
                                    <fields>
                                        <field>
                                            <type>ITEM_PROTOTYPE</type>
                                            <name>itemid</name>
                                            <value>
                                                <host>Acronis Cyber Protect Cloud MSP by HTTP</host>
                                                <key>acronis.cpc.device.agent.enabled[{#NAME}]</key>
                                            </value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>source_type</name>
                                            <value>3</value>
                                        </field>
                                    </fields>
                                </widget>
                                <widget>
                                    <type>GRAPH_PROTOTYPE</type>
                                    <x>15</x>
                                    <y>7</y>
                                    <width>9</width>
                                    <height>8</height>
                                    <fields>
                                        <field>
                                            <type>ITEM_PROTOTYPE</type>
                                            <name>itemid</name>
                                            <value>
                                                <host>Acronis Cyber Protect Cloud MSP by HTTP</host>
                                                <key>acronis.cpc.device.agent.online[{#NAME}]</key>
                                            </value>
                                        </field>
                                        <field>
                                            <type>INTEGER</type>
                                            <name>source_type</name>
                                            <value>3</value>
                                        </field>
                                    </fields>
                                </widget>
                            </widgets>
                        </page>
                    </pages>
                </dashboard>
            </dashboards>
            <valuemaps>
                <valuemap>
                    <uuid>0c425866d0ce4412a54b66f215df4cde</uuid>
                    <name>Alert severity</name>
                    <mappings>
                        <mapping>
                            <value>0</value>
                            <newvalue>OK</newvalue>
                        </mapping>
                        <mapping>
                            <value>1</value>
                            <newvalue>Warning</newvalue>
                        </mapping>
                        <mapping>
                            <value>2</value>
                            <newvalue>Error</newvalue>
                        </mapping>
                        <mapping>
                            <value>3</value>
                            <newvalue>Critical</newvalue>
                        </mapping>
                        <mapping>
                            <value>4</value>
                            <newvalue>Information</newvalue>
                        </mapping>
                        <mapping>
                            <value>10</value>
                            <newvalue>Unknown</newvalue>
                        </mapping>
                    </mappings>
                </valuemap>
                <valuemap>
                    <uuid>4a5652b3706a45faa2b86ae652425692</uuid>
                    <name>CyberFit score</name>
                    <mappings>
                        <mapping>
                            <value>-1</value>
                            <newvalue>Unavailable</newvalue>
                        </mapping>
                    </mappings>
                </valuemap>
                <valuemap>
                    <uuid>df45c606a7ef4f49a3101ad135eef1bc</uuid>
                    <name>True false</name>
                    <mappings>
                        <mapping>
                            <value>0</value>
                            <newvalue>False</newvalue>
                        </mapping>
                        <mapping>
                            <value>1</value>
                            <newvalue>True</newvalue>
                        </mapping>
                    </mappings>
                </valuemap>
            </valuemaps>
        </template>
    </templates>
    <graphs>
        <graph>
            <uuid>1950de4a315f487f9382d82c2dba1778</uuid>
            <name>Acronis CPC: Alerts overview</name>
            <type>PIE</type>
            <graph_items>
                <graph_item>
                    <color>1EA7FD</color>
                    <item>
                        <host>Acronis Cyber Protect Cloud MSP by HTTP</host>
                        <key>acronis.cpc.alerts.severity.info</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>1</sortorder>
                    <color>66BF3C</color>
                    <item>
                        <host>Acronis Cyber Protect Cloud MSP by HTTP</host>
                        <key>acronis.cpc.alerts.severity.ok</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>2</sortorder>
                    <color>E69D00</color>
                    <item>
                        <host>Acronis Cyber Protect Cloud MSP by HTTP</host>
                        <key>acronis.cpc.alerts.severity.warn</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>3</sortorder>
                    <color>FF4400</color>
                    <item>
                        <host>Acronis Cyber Protect Cloud MSP by HTTP</host>
                        <key>acronis.cpc.alerts.severity.err</key>
                    </item>
                </graph_item>
                <graph_item>
                    <sortorder>4</sortorder>
                    <color>E8083E</color>
                    <item>
                        <host>Acronis Cyber Protect Cloud MSP by HTTP</host>
                        <key>acronis.cpc.alerts.severity.crit</key>
                    </item>
                </graph_item>
            </graph_items>
        </graph>
    </graphs>
</zabbix_export>
